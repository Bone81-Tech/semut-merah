<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Produk - SEMUT</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="foodCanvas"></canvas>

    <div class="content">
        <header>
            <a href="index.html" class="logo-container">
                <img src="images/logo-semut/logo-semut.webp" alt="Logo SEMUT" class="logo">
            </a>
            <div class="auth-buttons">
                <button id="loginBtn" class="auth-btn">Login</button>
            </div>
            <div class="cart-icon-container" id="cartIcon">
                <svg class="cart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="16.5" cy="18.5" r="1.5"/>
                    <circle cx="9.5" cy="18.5" r="1.5"/>
                    <path d="M18,16H8.23a1,1,0,0,1-1-.84L4.45,4.84A1,1,0,0,0,3.46,4H2"/>
                    <path d="M5.21,6H18.32a1.33,1.33,0,0,1,1.24,1.79l-2,7A1.34,1.34,0,0,1,16.36,16H8.77"/>
                </svg>
                <span class="cart-count" id="cartCount">0</span>
            </div>
        </header>

        <main class="product-detail-main">
            <button class="back-btn" onclick="history.back()">&larr; Kembali</button>
            <div id="productDetailContainer" class="product-detail-container">
                <!-- Product details will be loaded here by JavaScript -->
                <p>Memuat detail produk...</p>
            </div>
        </main>

        <footer>
            <div class="footer-links">
                <a href="#" id="profilLink">Profil Pengguna</a>
                <a href="bantuan.html">Bantuan & FAQ</a>
            </div>
            <p>&copy; 2024 SEMUT</p>
        </footer>
    </div>

    
    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbx6cRkvA6IEBU6gYKSVrekuH3hrZ7DqNIpyPJgItxcGAsmZIJ-PDIUlHlI4sZPIhng/exec';

        function generateStars(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            for (let i = 0; i < 5; i++) { stars += i < fullStars ? '<span>&#9733;</span>' : '<span>&#9734;</span>'; }
            return stars;
        }

        // JavaScript for product detail page
        async function fetchProductDetailFromAPI(productId) {
            try {
                const response = await fetch(`${API_URL}?id=${productId}`);
                const result = await response.json();
                if (result.success && result.data) {
                    const item = result.data;
                    return {
                        id: parseInt(item.id_produk.replace('ujicoba_', '')),
                        name: item.nama_produk,
                        price: item.harga,
                        imageUrl: item.url_gambar,
                        rating: parseFloat(item.rating) || 0,
                        reviewCount: parseInt(item.jumlah_ulasan) || 0
                    };
                } else {
                    console.error('API returned an error:', result.message);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching product detail from API:', error);
                return null;
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('id'));
            const productDetailContainer = document.getElementById('productDetailContainer');

            if (productId) {
                productDetailContainer.innerHTML = '<p>Memuat detail produk...</p>'; // Show loading message
                const product = await fetchProductDetailFromAPI(productId);
                
                if (product) {
                    productDetailContainer.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.name}" class="product-detail-img">
                        <h2 class="product-detail-name">${product.name}</h2>
                        <p class="product-detail-price">Rp ${product.price.toLocaleString('id-ID')}</p>
                        <div class="rating product-detail-rating">
                            <div class="stars">${generateStars(product.rating)}</div>
                            <span class="review-count">(${product.reviewCount} Ulasan)</span>
                        </div>
                        <p class="product-detail-description">Ini adalah deskripsi detail untuk ${product.name}. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                        <button class="add-to-cart-btn" data-id="${product.id}">Tambah ke Keranjang</button>
                    `;
                } else {
                    productDetailContainer.innerHTML = '<p>Produk tidak ditemukan.</p>';
                }
            } else {
                productDetailContainer.innerHTML = '<p>ID Produk tidak valid.</p>';
            }
        });
    </script>
</body>
</html>